<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spring.mapper.cvs.TradeAdminMapper">


  <select id="selectOrderList" parameterType="spring.trade.dto.request.AdminOrderReq" resultType="spring.trade.dto.result.AdminTradeResult">
    SELECT
    p.id id,
    p.order_no orderNo,
    po.goods_picture goodsPicture,
    p.create_time createTime,
    p.total_price totalPrice,
    p.goods_num goodsNum,
    u.user_name memberName,
    p.order_price orderPrice,
    p.order_state orderState
    FROM
    p_orders p
    left JOIN p_orders_details po on p.id = po.order_no
    left join u_user_member u on p.user_id = u.id
    where 1=1
    <if test="orderNo != null">
      AND p.order_no LIKE concat("%",#{orderNo},"%")
    </if>
    <if test="userName != null">
      AND u.user_name LIKE concat("%",#{userName},"%")
    </if>
    <if test="orderState != null">
      and p.order_state = #{orderState}
    </if>
    <if test="startTime != null and endTime!= null">
      and  unix_timestamp(p.create_time) BETWEEN #{startTime,jdbcType=BIGINT} and #{endTime,jdbcType=BIGINT}
    </if>
    ORDER BY create_time DESC
  </select>

  <select id="selectAdminOrderDetails" resultType="spring.trade.dto.result.AdminTradeDetailsResult">
   SELECT
          p.order_no orderNo,
          p.order_type orderType,
          u.user_name memberName,
          p.received_name receivedName,
          p.phone phone,
          p.detailed_address address,
          p.address_no addressNo,
          p.remarks remarks,
          p.create_time createTime,
          p.order_state orderState
      FROM
      p_orders p
      left JOIN p_orders_details po on p.id = po.order_no
      left join u_user_member u on p.user_id = u.id
      where p.id = #{orderId}
  </select>
  <select id="selectOrderGoodsListResult" resultType="spring.trade.dto.result.OrderGoodsListResult">
   SELECT
      po.goods_price,
          g.goods_name,
          po.goods_condition,
          po.goods_price,
          po.you_pricce,
          po.discount_price,
          po.order_price
      FROM
      p_orders_details po
          JOIN p_goods g on po.goods_id = g.id
      where po.order_no = #{orderId}

  </select>

</mapper>